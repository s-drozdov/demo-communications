<p align="center">
    <h2 align="center">Пример применения DDD. <br> Предметная область - услуги связи.</h2>
</p>
<p align="center">
    <a href="https://github.com/yiisoft" target="_blank">
        <img src="https://avatars0.githubusercontent.com/u/993323" height="100px">
    </a>
    <h3 align="center">php8.3 - микросборка Yii2</h3>
    <br>
</p>
<p align="right">
    Always welcome with open arms...
    <a href="https://github.com/s-drozdov?tab=repositories" target="_blank">
        @Sergey Drozdov
    </a>
</p>

УСТАНОВКА
------------

Из корня проекта с хост-машины запустите:
```bash
make
```

Потребует ввести пароль для новой БД.

MAKEFILE команды
------------

* **make up** - сокращалка для docker compose up -d
* **make stop** - сокращалка для docker compose stop
* **make down** - сокращалка для docker compose down
* **make build** - билд образа с пробросом UID и GID текущего пользователя
* **make composer-install** - запуск composer с хост-машины
* **make yii-migrate** - накатка миграций с хост-машины


* **make create-env** - готовим оригинал .env с вводом пароля от БД
* **make create-db-config** - готовим оригинал конфига db.php с заполнением из .env


ОСНОВНОЙ КОНЦЕПТ
------------

### Единый язык

<u><b>Потребитель</b></u> _(Consumer)_ - уникальный пользователь услуг связи. Имеет полное имя _(FullName)_.

<u><b>Провайдер услуг связи</b></u> _(Provider)_ - компания, предоставляющая услугу связи.

<u><b>Устройство</b></u> _(Device)_ - Средство для получения услуг связи по различным каналам. Имеет состояние 
включено/выключено. Может принадледать только одному потребителю, либо не принадлежать никому.

<u><b>Модель устройства</b></u> _(DeviceModel)_ - Совокупность характеристик, присущих конкретному изделию. 
Описывает логику его работы в рамкам проектируемой модели. Может быть несколько устройств одной модели. 
Модель описывает возможность подключения устройства к каналам связи (GSM/Wifi/Ethernet). 

<u><b>Категория устройств</b></u> _(DeviceCategory)_ - для обозначения типа устройства. Некоторые категории
явно относятся к сетевому оборудованию.

<u><b>Сим-карта</b></u> _(SimCard)_ - один из каналов связи, может использоваться только устройствами 
моделей, у которых есть соответствующие слоты. Нельзя привязать к устройству больше сим-карт, чем имеется слотов. 
Потребители могут иметь неограниченное количество сим-карт. Сим-карта явно относится к определенному провайдеру 
и имеет уникальный номер телефона.

<u><b>Квартира</b></u> _(Apartment)_ - область предоставления услуги домашнего интернета. В квартире 
может проживать неограниченное количество потребителей. В одну квартиру можно завести
услуги нескольких провайдеров. Квартира имеет физический адрес _(Address)_.

### Структура данных. Выделение агрегатов.

![](docs/img/agregates.png)

### Отношения и бизнес-логика

Основное назначение - моделирование каналов связи. 
Имеются потребители, провайдеры услуг связи, устройства различных моделей, разделенные по категориям.
Провайдеры услуг выпускают сим-карты, и поставляют домашний интернет. Сим-карты можно вставлять в
устройства. Потребители могут быть владельцами конкретных устройств, приобретать сим-карты.

Потребители живут в квартирах. К квартире может быть подключен один или несколько провайдеров 
домашнего интернета.

У каждого устройства в зависимости от модели могут быть слоты сим/адаптеры Ethernet/Wifi.

Некоторые категории явно относятся к сетевому оборудованию. __ПРАВИЛО:__ Если в квартире с подключенным провайдером, 
проживает хотя бы один потребитель, имеющий устройство модели с Wifi адаптером с типом явно указывающим на сетевое 
оборудование, то для всех включенных устройств потребителей, проживающих в этой квартире, доступен Wifi канал связи.

TODO. План действий по развитию demo-проекта
============

- [x] Спроектировать минимально-необходимую структуру БД для хранения состояния по текущей бизнес-логике.
- [x] Набросать основной домен. Выделить агрегаты.
- [x] Доработать доку, приложить структуру данных, показать деление на агрегаты.
- [ ] Для каждой доменной сущности создать DataMapper для перевода в инфраструктурный ActiveRecord.
- [ ] Создать CRUD репозитории для агрегатов.
- [ ] Набросать операционный уровень - обозначить юзкейсы и зафиксировать бизнес-правила.
- [ ] Разработать модуль для симуляции работы серверов рассылки - Telegram, Gmail, SMS.
- [ ] Добавить UI уровень, создать REST и консольные команды для обращения к юзкейсам.
- [ ] Актуализировать доку для нового модуля.
- [ ] Для REST добавить swagger-описание.
- [ ] Покрыть тестами. Операционный, доменный уровни - модульными тестами. UI и инфраструктуру - функциональными.
- [ ] Показать гибкость DDD подхода при переходе на новый стек.
- [ ] Добавить простой frontend для мониторинга состояния системы и отправки сообщений с устройств.
